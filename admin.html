
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Passport Applications</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    #modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    #modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
    }
    #close-modal {
      float: right;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
    }
  </style>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://hvycjokchqstzhwbpves.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2eWNqb2tjaHFzdHpod2JwdmVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwOTYyMTIsImV4cCI6MjA2MTY3MjIxMn0.Vrl9r_f5NWe0KbO_c3QqiHVMZVgXofCFpJ4BjnnVN0o";

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    const loginSection = document.getElementById("login-section");
    const dashboardSection = document.getElementById("dashboard");
    const tableBody = document.querySelector("#applications tbody");
    const modal = document.getElementById("modal");
    const modalContent = document.getElementById("modal-body");

    document.getElementById("login-btn").addEventListener("click", () => {
      const password = document.getElementById("admin-password").value;
      if (password === "admin123") {
        loginSection.style.display = "none";
        dashboardSection.style.display = "block";
        loadApplications();
      } else {
        alert("Incorrect password");
      }
    
        setTimeout(() => {
          document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.id.replace('view-', '');
              const app = appMap[id];
              if (app) {
                modalContent.innerHTML = `
                  <h3>${app.first_name} ${app.last_name}</h3>
                  <p><strong>DOB:</strong> ${app.dob}</p>
                  <p><strong>Birth Place:</strong> ${app.birth_place}</p>
                  <p><strong>Nationality:</strong> ${app.nationality}</p>
                  <p><strong>Sex:</strong> ${app.sex}</p>
                  <p><strong>Height:</strong> ${app.height}</p>
                  <p><strong>Eye Color:</strong> ${app.eye_color}</p>
                  <p><strong>Hair Color:</strong> ${app.hair_color}</p>
                  <p><strong>Home Address:</strong> ${app.home_address}</p>
                  <p><strong>Mailing Address:</strong> ${app.mailing_address}</p>
                  <p><strong>Phone:</strong> ${app.phone}</p>
                  <p><strong>Email:</strong> ${app.email}</p>
                  <p><strong>Father Name:</strong> ${app.father_name}</p>
                  <p><strong>Father POB:</strong> ${app.father_pob}</p>
                  <p><strong>Mother Name:</strong> ${app.mother_name}</p>
                  <p><strong>Mother POB:</strong> ${app.mother_pob}</p>
                  <p><strong>Has Passport:</strong> ${app.has_passport ? "Yes" : "No"}</p>
                  <p><strong>Signature:</strong> ${app.signature}</p>
                  <p><strong>Application Date:</strong> ${app.application_date}</p>
                `;
                modal.style.display = "block";
              }
            });
          });
        }, 100);
      });


    document.getElementById("close-modal").onclick = function () {
      modal.style.display = "none";
    };

    async function loadApplications() {
      const { data, error } = await supabase.from("passport_applications").select("*").order("created_at", { ascending: false 
        setTimeout(() => {
          document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.id.replace('view-', '');
              const app = appMap[id];
              if (app) {
                modalContent.innerHTML = `
                  <h3>${app.first_name} ${app.last_name}</h3>
                  <p><strong>DOB:</strong> ${app.dob}</p>
                  <p><strong>Birth Place:</strong> ${app.birth_place}</p>
                  <p><strong>Nationality:</strong> ${app.nationality}</p>
                  <p><strong>Sex:</strong> ${app.sex}</p>
                  <p><strong>Height:</strong> ${app.height}</p>
                  <p><strong>Eye Color:</strong> ${app.eye_color}</p>
                  <p><strong>Hair Color:</strong> ${app.hair_color}</p>
                  <p><strong>Home Address:</strong> ${app.home_address}</p>
                  <p><strong>Mailing Address:</strong> ${app.mailing_address}</p>
                  <p><strong>Phone:</strong> ${app.phone}</p>
                  <p><strong>Email:</strong> ${app.email}</p>
                  <p><strong>Father Name:</strong> ${app.father_name}</p>
                  <p><strong>Father POB:</strong> ${app.father_pob}</p>
                  <p><strong>Mother Name:</strong> ${app.mother_name}</p>
                  <p><strong>Mother POB:</strong> ${app.mother_pob}</p>
                  <p><strong>Has Passport:</strong> ${app.has_passport ? "Yes" : "No"}</p>
                  <p><strong>Signature:</strong> ${app.signature}</p>
                  <p><strong>Application Date:</strong> ${app.application_date}</p>
                `;
                modal.style.display = "block";
              }
            });
          });
        }, 100);
      });

      if (error) {
        console.error("Error loading applications", error);
        return;
      }

      tableBody.innerHTML = "";
      
      const appMap = {};
      data.forEach((app, index) => {
        appMap[app.id] = app;
    
        const row = document.createElement("tr");
        const buttonId = 'view-' + app.id;
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${app.first_name} ${app.last_name}</td>
          <td>${app.email || "-"}</td>
          <td>${app.dob || "-"}</td>
          <td>${app.created_at?.slice(0, 10) || "-"}</td>
          <td><button id='${buttonId}' class='view-btn'>View</button></td>
        `;
        tableBody.appendChild(row);
      
        setTimeout(() => {
          document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.id.replace('view-', '');
              const app = appMap[id];
              if (app) {
                modalContent.innerHTML = `
                  <h3>${app.first_name} ${app.last_name}</h3>
                  <p><strong>DOB:</strong> ${app.dob}</p>
                  <p><strong>Birth Place:</strong> ${app.birth_place}</p>
                  <p><strong>Nationality:</strong> ${app.nationality}</p>
                  <p><strong>Sex:</strong> ${app.sex}</p>
                  <p><strong>Height:</strong> ${app.height}</p>
                  <p><strong>Eye Color:</strong> ${app.eye_color}</p>
                  <p><strong>Hair Color:</strong> ${app.hair_color}</p>
                  <p><strong>Home Address:</strong> ${app.home_address}</p>
                  <p><strong>Mailing Address:</strong> ${app.mailing_address}</p>
                  <p><strong>Phone:</strong> ${app.phone}</p>
                  <p><strong>Email:</strong> ${app.email}</p>
                  <p><strong>Father Name:</strong> ${app.father_name}</p>
                  <p><strong>Father POB:</strong> ${app.father_pob}</p>
                  <p><strong>Mother Name:</strong> ${app.mother_name}</p>
                  <p><strong>Mother POB:</strong> ${app.mother_pob}</p>
                  <p><strong>Has Passport:</strong> ${app.has_passport ? "Yes" : "No"}</p>
                  <p><strong>Signature:</strong> ${app.signature}</p>
                  <p><strong>Application Date:</strong> ${app.application_date}</p>
                `;
                modal.style.display = "block";
              }
            });
          });
        }, 100);
      });

    }

    window.viewDetails = (app) => {
      modalContent.innerHTML = `
        <h3>${app.first_name} ${app.last_name}</h3>
        <p><strong>DOB:</strong> ${app.dob}</p>
        <p><strong>Birth Place:</strong> ${app.birth_place}</p>
        <p><strong>Nationality:</strong> ${app.nationality}</p>
        <p><strong>Sex:</strong> ${app.sex}</p>
        <p><strong>Height:</strong> ${app.height}</p>
        <p><strong>Eye Color:</strong> ${app.eye_color}</p>
        <p><strong>Hair Color:</strong> ${app.hair_color}</p>
        <p><strong>Home Address:</strong> ${app.home_address}</p>
        <p><strong>Mailing Address:</strong> ${app.mailing_address}</p>
        <p><strong>Phone:</strong> ${app.phone}</p>
        <p><strong>Email:</strong> ${app.email}</p>
        <p><strong>Father Name:</strong> ${app.father_name}</p>
        <p><strong>Father POB:</strong> ${app.father_pob}</p>
        <p><strong>Mother Name:</strong> ${app.mother_name}</p>
        <p><strong>Mother POB:</strong> ${app.mother_pob}</p>
        <p><strong>Has Passport:</strong> ${app.has_passport ? "Yes" : "No"}</p>
        <p><strong>Signature:</strong> ${app.signature}</p>
        <p><strong>Application Date:</strong> ${app.application_date}</p>
      `;
      modal.style.display = "block";
    };
  </script>
</head>
<body>
  <h1 style="text-align:center;">Admin Dashboard</h1>

  <div id="login-section" style="text-align:center;">
    <input type="password" id="admin-password" placeholder="Enter admin password" />
    <button id="login-btn">Login</button>
  </div>

  <div id="dashboard" style="display:none; padding:20px;">
    <h2>Submitted Passport Applications</h2>
    <table id="applications" border="1" cellspacing="0" cellpadding="10" style="width:100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th>#</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>DOB</th>
          <th>Submitted At</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="modal">
    <div id="modal-content">
      <span id="close-modal">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</body>
</html>
